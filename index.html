<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Просмотр документа</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.4.0/mammoth.browser.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background-color: #f9f9f9; margin: 0; }
    .container { max-width: 900px; margin: 20px auto; background: white; padding: 10px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
    #document-container { padding: 15px; word-wrap: break-word; }
    .header { display: flex; justify-content: flex-end; padding: 10px; background: #fff; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
    .download-btn { padding: 8px 16px; border: 1px solid #ddd; cursor: pointer; }
  </style>
</head>
<body>
<div class="header">
  <button id="downloadBtn" class="download-btn">Скачать PDF</button>
</div>
<div class="container">
  <div id="document-container">Загрузка документа...</div>
</div>
<script>
  const { jsPDF } = window.jspdf;
  const params = new URLSearchParams(window.location.search);
  const type = params.get('type');
  const docxPath = type ? `assets/${type}.docx` : null;

  async function loadDocument() {
    if (!docxPath) {
      document.getElementById('document-container').innerHTML = '<p>Не указан тип документа.</p>';
      return;
    }
    try {
      const response = await fetch(docxPath);
      if (!response.ok) throw new Error('Файл не найден');
      const arrayBuffer = await response.arrayBuffer();
      const result = await mammoth.convertToHtml({ arrayBuffer });
      document.getElementById('document-container').innerHTML = result.value;
    } catch (error) {
      document.getElementById('document-container').innerHTML = `<p>Ошибка загрузки: ${error.message}</p>`;
    }
  }

  async function generateAndDownloadPDF() {
    const pdf = new jsPDF();
    const content = document.getElementById('document-container');
    const canvas = await html2canvas(content);
    const imgData = canvas.toDataURL('image/png');
    pdf.addImage(imgData, 'PNG', 10, 10, 180, 0);
    pdf.save(`${type || 'document'}.pdf`);
  }

  document.getElementById('downloadBtn').addEventListener('click', generateAndDownloadPDF);
  document.addEventListener('DOMContentLoaded', loadDocument);
</script>
</body>
</html>
